# 一个聊天室系统

Hub 管理客户端连接，负责用户在线状态查询（通过MySQL） -> （未来扩展） etcd 做服务发现、服务注册

每个 server 代表一个实例，实例中可以注册许多 client

client 可以创建房间，并挂载到 server 上

client 可以互相聊天，也可以发送到房间中

client 也可以向其他实例发送消息（指定人或者指定房间，不能发系统消息）

不同实例的 client 之间不能建立房间

client 可以切换实例

支持系统消息发放，每个实例每个 client 都会收到

支持系统向 room 发消息，警告、通知、提示等

（这样看来，实例就像是区服一样）

## 数据存储与消息流

MySQL 存储用户状态信息和消息持久化，支持历史消息查询和重加载
- 用户表：存储用户基本信息和状态
- 消息表：存储所有消息记录
- 房间表：存储房间信息和成员关系

Redis 作为临时消息缓存，提高读写性能，减轻数据库压力
- 热点消息缓存
- 临时会话状态

单实例内部通信：WebSocket（HTTP长轮询作为回退方案）
跨实例消息传递：通过Kafka进行通信

## 技术栈

- 后端框架：Gin
- 配置管理：Viper
- 数据库：MySQL
- 缓存：Redis
- 消息队列：Kafka
- 通信协议：WebSocket/HTTP长轮询
- API风格：RESTful API
- 负载均衡：Nginx